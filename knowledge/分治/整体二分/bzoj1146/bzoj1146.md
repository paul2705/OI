#### $1146: [CTSC2008]网络管理Network$

* 题面描述

  * M公司是一个非常庞大的跨国公司，在许多国家都设有它的下属分支机构或部门。为了让分布在世界各地的N个部门之间协同工作，公司搭建了一个连接整个公司的通信网络。该网络的结构由N个路由器和N-1条高速光缆组成。每个部门都有一个专属的路由器，部门局域网内的所有机器都联向这个路由器，然后再通过这个通信子网与其他部门进行通信联络。该网络结构保证网络中的任意两个路由器之间都存在一条直接或间接路径以进行通信。 高速光缆的数据传输速度非常快，以至于利用光缆传输的延迟时间可以忽略。但是由于路由器老化，在这些路由器上进行数据交换会带来很大的延迟。而两个路由器之间的通信延迟时间则与这两个路由器通信路径上所有路由器中最大的交换延迟时间有关。作为M公司网络部门的一名实习员工，现在要求你编写一个简单的程序来监视公司的网络状况。该程序能够随时更新网络状况的变化信息（路由器数据交换延迟时间的变化），并且根据询问给出两个路由器通信路径上延迟第k大的路由器的延迟时间。
* 【任务】 你的程序从输入文件中读入N个路由器和N-1条光缆的连接信息，每个路由器初始的数据交换延迟时间Ti，以及Q条询问（或状态改变）的信息。并依次处理这Q条询问信息，它们可能是： 
  * 1. 由于更新了设备，或者设备出现新的故障，使得某个路由器的数据交换延迟时间发生了变化。
  2. 查询某两个路由器a和b之间的路径上延迟第k大的路由器的延迟时间。
  
* 输入格式

  * 第一行为两个整数N和Q，分别表示路由器总数和询问的总数。

    第二行有N个整数，第i个数表示编号为i的路由器初始的数据延迟时间Ti。

    紧接着N-1行，每行包含两个整数x和y。表示有一条光缆连接路由器x和路由器y。

    紧接着是Q行，每行三个整数k、a、b。

    如果k=0，则表示路由器a的状态发生了变化，它的数据交换延迟时间由Ta变为b。如果k>0，则表示询问a到b的路径上所经过的所有路由器（包括a和b）中延迟第k大的路由器的延迟时间。

    注意N,Q<=80000,任意一个路由器在任何时刻都满足延迟时间小于10^8。对于所有询问满足0<=K<=N

* 输出格式

  * 对于每一个第二种询问（k>0），输出一行。包含一个整数为相应的延迟时间。如果路径上的路由器不足k个，则输出信息“invalidrequest!”（全部小写不包含引号，两个单词之间有一个空格）。

* 题解

  * 题意就是给定一棵树，树上每个点有一个点权，但点权动态更新，并询问对于一段路径中第$K$大的点权是多少。
  * 首先区间第$K$大是满足二分性质的，因此我们考虑将这些操作、询问全部丢进整体二分。
  * 那么我们考虑我们已经二分出一个mid，现在问对于当前子问题中的询问，他们的答案>mid还是<mid。我们将当前子问题中点权>=mid的加入树链剖分中，如果询问>mid，就丢到右边；否则丢到左边。
  * 但在子问题中的操作按理要在左右儿子中都复制一遍，这样的话复杂度就爆炸了。不过我们能观察到，我们像线段树二分一样，如果答案<mid，即当前ans<=aim，我们可以将aim 减去 当前ans，这样就和点权>=mid的操作无关了，那么我们可以将点权>=mid的操作丢到右儿子，把点权<mid的操作丢到左儿子。就可以了